
---
## Step 2 â€“ ë„ë©”ì¸ ëª¨ë¸ë§ & í•µì‹¬ íë¦„ ì‚°ì¶œë¬¼

**(Domain Model / ID Strategy / NAS Index Design)**

### ë¬¸ì„œ ë²„ì „

* Document Version: **v1.0**
* ì‘ì„± ë‹¨ê³„: **Step 2 ì¢…ë£Œ ì‚°ì¶œë¬¼**

---

## 1. Step 2 ëª©ì 

* í•µì‹¬ ë„ë©”ì¸ ì—”í‹°í‹° ì •ì˜
* Provider/Node/Connector ê²½ê³„ í™•ì •
* NAS Index DB ì„¤ê³„ í™•ì •
* **ë¶ˆë³€ node_id ì „ëµ í™•ì •**

---

## 2. í•µì‹¬ ë„ë©”ì¸ ì—”í‹°í‹°

### Provider

* í•˜ë‚˜ì˜ ìŠ¤í† ë¦¬ì§€ ë£¨íŠ¸ë¥¼ ëŒ€í‘œí•˜ëŠ” ë…¼ë¦¬ ë‹¨ìœ„

**ì£¼ìš” ì†ì„±**

* provider_id
* provider_key
* type
* status

---

### Node (File / Folder)

* Provider ë‚´ë¶€ íŒŒì¼/í´ë”ì˜ í†µí•© í‘œí˜„

**ì£¼ìš” ì†ì„±**

* node_id (ì™¸ë¶€ ë…¸ì¶œ, ë¶ˆë³€)
* provider_id
* kind (FILE/FOLDER)
* path (ê°€ë³€)
* source_ref
* metadata(size, mtime ë“±)

---

## 3. node_id ì •ì˜ (í™•ì •)

> **node_idëŠ” Unified Storage Backendê°€ ì™¸ë¶€ì— ë…¸ì¶œí•˜ëŠ”
> ì „ì—­ ìœ ë‹ˆí¬ Â· ë¶ˆë³€ ë…¼ë¦¬ ì‹ë³„ìì´ë‹¤.**

### íŠ¹ì§•

* rename/move í›„ì—ë„ ë™ì¼
* pathì™€ ë…ë¦½ì 
* Provider êµ¬í˜„ê³¼ ë…ë¦½ì 

---

## 4. Providerë³„ node_id ì „ëµ

### Cloud Provider

* source_ref = provider native immutable id
* node_idëŠ” native id ê¸°ë°˜

### NAS Provider

* source_ref = (device, inode)
* ìµœì´ˆ ë°œê²¬ ì‹œ ë‚´ë¶€ `node_uuid(UUID)` ë°œê¸‰
* rename/move ì‹œ pathë§Œ ì—…ë°ì´íŠ¸

---

## 5. NAS Index DB ì„¤ê³„

### nas_nodes

* node_uuid (ë¶ˆë³€)
* provider_id
* source_ref (UNIQUE)
* path
* parent_path
* metadata
* is_deleted

### nas_index_runs

* ì¸ë±ì‹± ì‹¤í–‰ ì´ë ¥
* ìš´ì˜ ê°€ì‹œì„± ëª©ì 

---

## 6. Connector êµ¬ì¡°

### ê³µí†µ ì¸í„°í˜ì´ìŠ¤

* list
* get
* download
* health

### NAS Connector

* ì¡°íšŒ: Index DB
* ë‹¤ìš´ë¡œë“œ: Local FS streaming

### Cloud Connector

* Provider API/SDK ê¸°ë°˜

---

## 7. NAS Indexer

* APIì™€ ë¶„ë¦¬ëœ ì»´í¬ë„ŒíŠ¸
* ì´ˆê¸° Full Scan + ì£¼ê¸°ì  í´ë§
* tombstone ê¸°ë°˜ ì‚­ì œ ë°˜ì˜

---

## 8. í•µì‹¬ ì‹œë‚˜ë¦¬ì˜¤ ìš”ì•½

* ëª©ë¡ ì¡°íšŒ â†’ Connector â†’ DB/Provider
* ë‹¨ê±´ ì¡°íšŒ â†’ node_id ê¸°ë°˜
* ë‹¤ìš´ë¡œë“œ â†’ providerë³„ streaming/redirect

---

## 9. Step 2 ì¢…ë£Œ ì„ ì–¸

* ë„ë©”ì¸ ëª¨ë¸ í™•ì •
* node_id ë¶ˆë³€ ì „ëµ í™•ì •
* NAS Index DB ì„¤ê³„ í™•ì •
* Step 3(API ëª…ì„¸) ì§„í–‰ ê°€ëŠ¥ ìƒíƒœ

---

### âœ… ë‹¤ìŒ ë‹¨ê³„

ğŸ‘‰ **Step 3 â€“ API ëª…ì„¸(OpenAPI) & ì—ëŸ¬/ì¸ì¦ ìµœì†Œ ì„¤ê³„**

ì›í•˜ë©´ ë‹¤ìŒ ë©”ì‹œì§€ì—ì„œ **OpenAPI ìŠ¤í™ ì´ˆì•ˆ**ì„ ë°”ë¡œ ì‘ì„±í•œë‹¤.